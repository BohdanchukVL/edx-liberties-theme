## mako
<%page expression_filter="h"/>
<%namespace name='static' file='static_content.html'/>

<%!
import json

from django.conf import settings
from django.urls import reverse
from django.utils.translation import ugettext as _

from openedx.core.djangoapps.user_api.accounts.image_helpers import get_profile_image_urls_for_user
from openedx.core.djangoapps.user_api.accounts.toggles import should_redirect_to_order_history_microfrontend
from openedx.core.djangoapps.user_api.accounts.utils import retrieve_last_sitewide_block_completed
from openedx.features.enterprise_support.utils import get_enterprise_learner_generic_name, get_enterprise_learner_portal
%>

<%
## This template should not use the target student's details when masquerading, see TNL-4895
self.real_user = getattr(user, 'real_user', user)
profile_image_url = get_profile_image_urls_for_user(self.real_user)['medium']
username = self.real_user.username
resume_block = retrieve_last_sitewide_block_completed(self.real_user)
displayname = get_enterprise_learner_generic_name(request) or username
enterprise_customer_portal = get_enterprise_learner_portal(request)
## Enterprises with the learner portal enabled should not show order history, as it does
## not apply to the learner's method of purchasing content.
should_show_order_history = should_redirect_to_order_history_microfrontend() and not enterprise_customer_portal
%>


<button id="dropdownUserAvatarButton" data-dropdown-toggle="dropdownAvatar" class="user-dropdown flex mx-3 items-center justify-center text-sm bg-gray-800 rounded-full md:mr-0" type="button">
    <span class="sr-only">Open user menu</span>
    <svg width="62" height="52" viewBox="0 0 62 52" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path fill-rule="evenodd" clip-rule="evenodd" d="M29.1029 30.136V28.0677C29.5682 27.837 30.8992 26.2528 31.0387 25.0149C31.4048 24.987 31.9799 24.6509 32.1494 23.3241C32.2404 22.6116 31.8785 22.2114 31.6591 22.0852C31.6591 22.0852 32.2053 21.048 32.2053 19.7956C32.2053 17.2847 31.2197 15.142 29.1029 15.142C29.1029 15.142 28.3676 13.5908 26.0004 13.5908C21.6136 13.5908 19.7956 16.4047 19.7956 19.7956C19.7956 20.9373 20.3416 22.0852 20.3416 22.0852C20.1224 22.2114 19.7605 22.6126 19.8515 23.3241C20.0211 24.6509 20.596 24.987 20.9621 25.0149C21.1017 26.2528 22.4327 27.837 22.898 28.0677V30.136C21.8639 33.2383 13.5908 31.1701 13.5908 38.409H38.41C38.41 31.1701 30.137 33.2383 29.1029 30.136Z" fill="#DBDEE7"/>
        <path fill-rule="evenodd" clip-rule="evenodd" d="M58.0975 25.9154C58.4525 25.5604 58.4525 24.9848 58.0975 24.6298C57.7425 24.2748 57.1668 24.2748 56.8118 24.6298L52.0001 29.4415L47.1884 24.6298C46.8334 24.2748 46.2578 24.2748 45.9027 24.6298C45.5477 24.9848 45.5477 25.5604 45.9027 25.9154L51.3573 31.37C51.7123 31.725 52.2879 31.725 52.6429 31.37L58.0975 25.9154Z" fill="#E2E2E2"/>
    </svg> 
</button>

<!-- Dropdown menu -->
<div id="dropdownAvatar" class="hidden z-10 w-44 bg-white rounded divide-y divide-gray-100 shadow dark:bg-gray-700 dark:divide-gray-600">
    <ul class="py-1 text-sm text-gray-700 dark:text-gray-200" aria-labelledby="dropdownUserAvatarButton">
        % if resume_block:
            <li>
                <a href="${resume_block}" class="block py-2 px-4 hover:bg-gray-100">${_("Resume your last course")}</a>
            </li>
        % endif
        % if not enterprise_customer_portal:
            <li>
                <a href="${reverse('dashboard')}" class="block py-2 px-4 hover:bg-gray-100">${_("Dashboard")}</a>
            </li>
        % else:
            <li>
                <a href="${settings.ENTERPRISE_LEARNER_PORTAL_BASE_URL}/${enterprise_customer_portal.get('slug')}" class="block py-2 px-4 hover:bg-gray-100">${_("Dashboard")}</a>
            </li>
        % endif
        <li>
            <a href="${reverse('learner_profile', kwargs={'username': username})}" class="block py-2 px-4 hover:bg-gray-100">${_("Profile")}</a>
        </li>
        <li>
            <a href="${reverse('account_settings')}" class="block py-2 px-4 hover:bg-gray-100">${_("Account")}</a>
        </li>
        % if should_show_order_history:
            <li>
                <a href="${settings.ORDER_HISTORY_MICROFRONTEND_URL}" class="block py-2 px-4 hover:bg-gray-100">${_("Order History")}</a>
            </li>
        % endif
    </ul>
    <div class="py-1">
        <a href="${reverse('logout')}" class="block py-2 px-4 text-sm text-gray-700 hover:bg-gray-100">${_("Sign Out")}</a>
    </div>
</div>
